<!DOCTYPE html>
<html>
<head>
    <title>贪吃蛇迷宫</title>
    <style>
        canvas {
            border: 2px solid #333;
            background-color: #f0f0f0;
        }
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #e0e0e0;
        }
        #score {
            font-size: 24px;
            margin: 10px;
        }
        .game-over {
            position: absolute;
            color: red;
            font-size: 48px;
            font-weight: bold;
            display: none;
        }
    </style>
</head>
<body>
    <div id="score">得分: 0</div>
    <canvas id="gameCanvas" width="480" height="480"></canvas>
    <div class="game-over" id="gameOver">游戏结束!</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const scoreElement = document.getElementById('score');
const gameOverElement = document.getElementById('gameOver');

const GRID_SIZE = 20;
const CELL_SIZE = canvas.width / GRID_SIZE;

// 迷宫地图 (1表示墙壁)
const maze = [
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    [1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1],
    [1,0,1,1,1,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,1,0,1],
    [1,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1],
    [1,0,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1],
    [1,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,1],
    [1,0,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,1,0,1],
    [1,0,0,0,0,0,0,0,1,0,1,0,1,0,1,0,1,0,0,0,0,0,0,1],
    [1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,0,1,0,1,1,1,1,1,1],
    [1,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,1],
    [1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
];

let snake = [
    { x: 2, y: 1 },
    { x: 1, y: 1 }
];
let direction = 'right';
let food = generateFood();
let score = 0;
let gameLoop;

function generateFood() {
    while(true) {
        const x = Math.floor(Math.random() * (GRID_SIZE - 2)) + 1;
        const y = Math.floor(Math.random() * (GRID_SIZE - 2)) + 1;
        
        // 检查食物不在墙上和蛇身上
        if (maze[y][x] === 0 && !snake.some(segment => segment.x === x && segment.y === y)) {
            return { x, y };
        }
    }
}

function drawMaze() {
    ctx.fillStyle = '#666';
    for(let y = 0; y < maze.length; y++) {
        for(let x = 0; x < maze[y].length; x++) {
            if(maze[y][x] === 1) {
                ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
            }
        }
    }
}

function draw() {
    // 清空画布
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // 绘制迷宫
    drawMaze();
    
    // 绘制食物
    ctx.fillStyle = 'red';
    ctx.fillRect(food.x * CELL_SIZE, food.y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
    
    // 绘制蛇
    snake.forEach((segment, index) => {
        ctx.fillStyle = index === 0 ? '#2ecc71' : '#27ae60';
        ctx.fillRect(segment.x * CELL_SIZE, segment.y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
    });
}

function move() {
    const head = { ...snake[0] };
    
    switch(direction) {
        case 'up': head.y--; break;
        case 'down': head.y++; break;
        case 'left': head.x--; break;
        case 'right': head.x++; break;
    }
    
    // 碰撞检测
    if (maze[head.y][head.x] === 1 || // 撞墙
        snake.some(segment => segment.x === head.x && segment.y === head.y)) { // 撞自己
        gameOver();
        return;
    }
    
    snake.unshift(head);
    
    // 吃到食物
    if(head.x === food.x && head.y === food.y) {
        score += 10;
        scoreElement.textContent = `得分: ${score}`;
        food = generateFood();
    } else {
        snake.pop();
    }
}

function gameOver() {
    cancelAnimationFrame(gameLoop);
    gameOverElement.style.display = 'block';
}

function gameStart() {
    if(gameLoop) cancelAnimationFrame(gameLoop);
    snake = [
        { x: 2, y: 1 },
        { x: 1, y: 1 }
    ];
    direction = 'right';
    score = 0;
    scoreElement.textContent = `得分: ${score}`;
    food = generateFood();
    gameOverElement.style.display = 'none';
    gameLoop = requestAnimationFrame(update);
}

function update() {
    move();
    draw();
    gameLoop = requestAnimationFrame(update);
}

// 控制方向
document.addEventListener('keydown', (e) => {
    switch(e.key) {
        case 'ArrowUp':
            if(direction !== 'down') direction = 'up';
            break;
        case 'ArrowDown':
            if(direction !== 'up') direction = 'down';
            break;
        case 'ArrowLeft':
            if(direction !== 'right') direction = 'left';
            break;
        case 'ArrowRight':
            if(direction !== 'left') direction = 'right';
            break;
    }
});

// 重新开始游戏
document.addEventListener('keydown', (e) => {
    if(e.key === ' ' && gameOverElement.style.display === 'block') {
        gameStart();
    }
});

// 开始游戏
gameStart();
</script>
</body>
</html>